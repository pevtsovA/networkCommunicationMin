# networkCommunicationMin
Основная функция приложения - хранить информацию о пользователях: id, имя, возраст, друзья.
Можно добавить пользователя,  подружить двух пользователей, удалить пользователя, вернуть информацию о друзьях по конкретному пользователю, обновить возраст у пользователя, вернуть информацию по всем пользователям.

Приложение представляет собой HTTP-сервис, который принимает входящие соединения с JSON-данными и обрабатывает их.
Также реализован proxy сервер, который умеет перераспределять запросы на ту реплику приложения, на которой меньше всего было обращений. Это в случае если будет поднято несколько реплик приложения.


# Настройка
(Актуально для ОС windows)
1. Установить postgresql
2. Запустить из корня проекта файл configure.bat
3. Ввести пароль от postgresql в открывшемся окне
4. Открыть сетевые порты: 8080, 3000, 8081, 8082, 8088 (
   - открыть: Панель управления\Все элементы панели управления\Брандмауэр Защитника Windows
   - далее открыть Дополнительные параметры
   - создать правило для входящих подключений: для порта, протокол TCP, указать нужные порты)

(Актуально для любой ОС)
1. Установить Docker Desktop
2. В консоли выполнить команду: docker compose build (собрать проект)
3. В консоли выполнить команду: docker compose up (запустить проект)


# Запуск приложения
- запуск реплики приложения: cd server; go build -o server.exe; ./server.exe --port 8080 --dbpassword ********
  
    (доступно 4 порта для сервиса: 8080,8081,8082,8088)


- запуск proxy: cd proxy; go build -o proxy.exe; ./proxy.exe --port 3000


# Примеры запросов через curl:

- Добавить пользователя: curl -X POST -d "{\"name\": \"Igor\", \"age\": 20, \"friends\": []}" -H "Content-Type: application/json" http://localhost:3000/create
- Подружить 2-х пользователей: curl -X POST -d "{\"source_id\": 1, \"target_id\": 2}" -H "Content-Type: application/json" http://localhost:3000/make_friends
- Удалить пользователя: curl -X DELETE -d "{\"target_id\": 1}" -H "Content-Type: application/json" http://localhost:3000/user
- Посмотреть друзей у пользователя: curl -X GET http://localhost:3000/friends/1
- Изменить возраст пользователя: curl -X PUT -d "{\"new_age\": 28}" -H "Content-Type: application/json" http://localhost:3000/user_id/1
- Посмотреть информацию по всем пользователям: curl -X GET http://localhost:3000/get_all

