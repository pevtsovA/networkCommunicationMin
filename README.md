# networkCommunicationMin
HTTP-сервис, который принимает входящие соединения с JSON-данными и обрабатывает их.
Работь может как через поднятую реплику приложения, так и через прокси.

Можно добавить пользователя,  подружить двух пользователей, удалить пользователя, вернуть информацию о друзьях по конкретному пользователю, обновить возраст у пользователя, вернуть информацию по всем пользователям.

# Настройка
1. Установить postgresql
2. Запустить из корня проекта файл configure.bat
3. Ввести пароль от postgresql в открывшемся окне
4. Ввести команду: create database socnetworkdb; (создание тестовой БД)
5. Ввести команду: \c socnetworkdb (подключение к этой БД)
6. Ввести команду: CREATE TABLE Users (Id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, Name varchar(30), Age integer, Friends integer[]); (Создание таблицы для приложения)
7. В файле networkCommunicationMin\server\server.go в переменной connStr указать пароль от БД postgresql вместо звёздочек
8. Открыть сетевые порты: 8080, 3000, 8081, 8082, 8088


# Запуск приложения
- перейти в каталог server (cd server)

go build -o server.exe

./server.exe --port 8080 (доступно 4 порта для сервиса: 8080,8081,8082,8088)

- перейти в каталог proxy (cd proxy)

go build -o proxy.exe

./proxy.exe --port 3000

При отправке запроса на proxy, если будет поднято несколько реплик приложения, то запросы будут уходить на ту реплику, на которой меньше всего было обращений.

# Примеры запросов через curl:

- Добавить пользователя: curl -X POST -d "{\"name\": \"Igor\", \"age\": 20, \"friends\": []}" -H "Content-Type: application/json" http://localhost:3000/create
- Подружить 2-х пользователей: curl -X POST -d "{\"source_id\": 1, \"target_id\": 2}" -H "Content-Type: application/json" http://localhost:3000/make_friends
- Удалить пользователя: curl -X DELETE -d "{\"target_id\": 1}" -H "Content-Type: application/json" http://localhost:3000/user
- Посмотреть друзей у пользователя: curl -X GET http://localhost:3000/friends/1
- Изменить возраст пользователя: curl -X PUT -d "{\"new_age\": 28}" -H "Content-Type: application/json" http://localhost:3000/user_id/1
- Посмотреть информацию по всем пользователям: curl -X GET http://localhost:3000/get_all

